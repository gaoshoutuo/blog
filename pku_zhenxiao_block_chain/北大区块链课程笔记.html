<html lang="en">
    <head>

        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=0.5">

        <link href="http://www.yinwang.org/main.css" rel="stylesheet" type="text/css">
        <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Atom feed">
        <link rel="shortcut icon" href="http://www.yinwang.org/images/Yc.jpg">

        <title>自律</title>

        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                                    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
            ga('create', 'UA-45586344-1', 'yinwang.org');
            ga('send', 'pageview');
        </script>
    </head>

    <body>
        <script>
            if (/mobile/i.test(navigator.userAgent) || /android/i.test(navigator.userAgent))
            {
               document.body.classList.add('mobile');
            }
        </script>

        <!--
        <div class="ad-banner" style="margin-bottom: 5px">
            <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
            <ins class="adsbygoogle"
                    style="display:inline-block;width:100%;height:90px"
                    data-ad-client="ca-pub-1331524016319584"
                    data-ad-slot="6657867155"></ins>
            <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
        </div>
        -->

        <div class="inner">
            <h2>北大区块链课程的笔记</h2>
           <p> 2020.11.11     做事情就应该要义无反顾的。大城市的人的特质比小城市可厉害太多了。</p>
            <p>2.比特币中的密码学
            <span>密码学有两条性质 哈希与签名，其中哈希的两条性质哈希膨胀 与 hidding  比特币中要多一条性质那就是puzzle friendly。
            先解释 哈希膨胀  对于x H(X)就是他的哈希值，密码学中也称digest 摘要。对于要求的X空间，存在有2^x
                个哈希值的取值范围，其中可能存在x!=y 但是HX=HY的情况这就是我们所说的哈希碰撞，此外我们还要就
                X的取值范围要比较连续平滑，HX也是，不能集中在某一些范围。x的取值空间要足够的大，用来防止以遍历
                的手段撞上同一个hash 然后得到x。为了得到一个比较正规的X范围 在比特币中。通常是 H_HEADER+NONCE.也就是
                X后跟一个随机数来保证X'的符合标准。第二层hidding的意思就是在HX的值可以公布，但是X的值不去公布，很难通过
                HX的值去计算X。MD5就是一种被我国王小云教授破解的失败的HASH函数。而比特币所要求的puzzle friendly 就是
                对于挖矿 HX要在某一个范围 例如在HX 在256位 前顶K位数的0的hash范围，挖矿就是在求这个nonce，但是nonce总是
                随机的，如今并没有好的办法去找到好的nonce直接破解难度，唯一就是硬用算力去算，谁算力大，谁越可能找到nonce，然后
                找到区块链获得铸币权。这也叫做工作量证明。比特币中使用sha-256hash算法，sercure hash algorithm
            </span>
                <span>比特币中的签名性质，每个人都有地址，需要用公钥私钥这对密钥，非对称加密体系弄得。对称加密是加密解密
                    用的都是同一把钥匙，密钥需要传输，密钥丢失就麻烦了。所以需要有一对密钥。也就是公钥传送给其他接受方，而
                    私钥自己保存，公钥用来加密信息，私钥用来解密信息。另外摘要为了防止篡改，需要自己的私钥用来生成摘要签名，
                    公钥验证签名，是否是本人，。

                    假如两个人生成的公私钥生成 相等一个人把另一个人账户的钱取走。这种情况存在但是几乎不可能，还是看密钥对生成算法
                    的。imtoken杭州就不知道被套话了还是怎么的，有一个人声称，自己用hasj碰撞撞到一个10w美元代币的账户。imtoken都把算法出处说了。
                    比特币要求的签名算法不仅生成密钥对的时候需要好的空间范围随机性，而且在签名的时候也需要好的随机源，不然容易泄露私钥。
                    诶菜才回三门牛早去杭州了
                </span>

            </p>
            <p>3 比特币中的数据结构
            <span>
                区块链也就是由一个个区块组成的链表。想象一个创世区块被第二个指着，第三个指着，然后继续，后一个区块存储前一个
                区块的HX，防止篡改。篡改传递。只要记住最后端的一个HX或者记住中间随便一个都可以去验证前面的区块。牵一发动全身。
                减少存储空间只需要记录几千个最近区块。去中心化的防止恶意节点。
            </span>
                <span>另一个数据结构是，merkle tree 只要记住根hash值，整颗树都能知道有没有被修改。比链表的效率更高一些。
                最底层是 data block 记录的是 交易 然后一层一层 HX HX F(HX HX) 上去到根hash值 上层全是hash pointer
                哈希指针。每个data block 都分header 与 body  header只有hash值  body则有交易的内容。MT有什么用呢，提供mercle proof。
                比特币有两种数据节点 全节点与轻节点 全节点含有头与身体，轻只有头，轻一般是钱包应用。MT包含在区块链的一个block中，应该就是body。
                那么如何向轻节点钱包证明某一条记忆记录已经被写到区块当中了呢。需要证明 也就是从叶子节点到根节点的一个路径。需要从自身的tx交易
                出发 提供HX 与自身另外一个HX 在上层依次到根节点。重节点要将mp 发送给轻节点用来证明。篡改 hash
                膨胀只能理论科学 collision resistance
                ologn 伙伴证明 on 非伙伴证明，但是叶节点的排列顺序对hash做排序则出现好的结果ologn 其实就是线性二分。
                sorted merkle tree 比特币不要求作顺序 比特币不要求不存在证明 二分的无环，总能二分到一对上或者中间的hash也就能
                找不存在。对啊 区块链的鸽子笼原理 怎么保证无环的区块</span>
            </p>

            <p>4-BTC协议
                <span>央行发行数字货币。央行的公钥对所有数字货币加密并且自己保存私钥，私钥给所有的数字货币做前面。
                所有帐户都有公钥能够对数字货币做验证，是否真的是央行发行的，盗取央行的私钥。数字货币就是个文件，文件可以复制，就是不能够复制。避免双花
                    。那么假如对所有数字货币进行编号记录在一个大数据库里面，而且要知道币在谁手里。不仅验证真币还得验证在谁手里。
                    但是这又不是去中心化了，可以这么做，但是并不去中心化。要依赖我们的区块链。
                    比特币系统的铸币权 铸币税是由挖矿决定的,数据结构不仅仅是央行维护的，而是所有用户共同维护就是央行.
                header 中的5个字段就是hash 以及 MThash version target nonce</span>
                <span>例如一个例子 A(10)->B(5)||C(5).比特币转账要说明两点一点就是币的来源合法另一点就是接收方的地址 ，mint。需要插图了。把钱
                转给别人需要自己的私钥签字，私钥做的事情代表是自己本人以及做本人才人做的事情。交易区块不仅包含哈希指针，
                而且还包含指向币的来源的指针，其实也就是写个字段 或者通过某种形式的next list指向来源</span>
                <span>繁琐的玩具  A给B转账 A需要知道B的公钥地址账户  B也需要知道A的公钥用来签名而且需要知道A的余额。所有节点都需要知道A的公钥。
                这不就得持有太多太多信息了，所有人如何知道A的公钥，完美的安全感觉效率太慢了，可以牺牲一部分吧。A给B交易本身则需要
                    输入A的公钥。那么假设有一个恶意节点传输交易，传输自己的公钥并且用自己的私钥去签名而且以A的名义，不就花了A的钱吗。
                    所以需要提供A的公钥以及币的来源看看来源交易中的公钥跟A的公钥是否相等。币的来源是公钥的哈希。
                    例如A交易，本身的输入加上前面币来源的输出组成一个比特币脚本，试试看能否运行，也就能够确证是否转账。
                </span>
                <span>
                    比特币转账交易的记账权。如果是投票来取得consens共识，则每次的投票效率过低。于是需要选出可信的记账节点。
                    联盟链hyperledger fabic的做法就是几个大公司组成的节点是可信的，然后由这些节点记账。也就是超级账本。比特币不是这种
                    方式去获取记账权，而且记账权的设计应该要满足应记尽记录，而不是有自己的私心决定谁能够被记录谁不能。另一种投票方式
                    是按照账号投票，这样不公平，因为恶意节点可以注册大量的废马甲来恶意投票选出恶意节点，这也被叫做女巫攻击 sybil attack.比特币通过
                    挖矿争夺记账权，本质就是算力来做记账权，本地node不停的试H header+nonce 4个字节的nonce 的随机域低于target来满足符合要求的条件，
                    比特币系统根据要求来动态调整target的前置0，以调整挖矿难度，比特币设计21w个区块过后，初块奖励减半。最开始的coinbase
                    有50BTC，后来是25，再后来12.5比特币网络是不断通缩的。比特币中的共识机制就是通过算力pow来挖矿争夺记账权。
                    分布式协议PAXOS与RAFT这边先不表，前者满足三大性质CAP的consistency一致性。CAP涉及拜占庭问题，且三个性质为不可能三角关系，
                    即最多满足其中两个，有个政治笑话说得好，良知真诚党性最多满足其三。其中A为 可用性Availabilty、，以及分区容忍性 prtition tolerance。
                    FLP三位在分布式领域的专家人物，分布式恩好好学，然后肖老师的背景也是做分布式出身的。做科研懂大框架，找地方修补，然后
                    找方向。弹幕说500个超算中心不如一个ASIC矿场对于比特币的挖矿。还有一个重要的性质，也就是最长链原则，当你挖出区块的时候，
                    不要高兴太早，应该要祈祷别人没人跟你同时挖出，不然的话要竞争成为最长链条，这也是共识协议POW的一部分，
                    而且当成为孤儿节点的时候，由于在非主链上币的来源不合法，其上的所有交易信息都将不被承认。
                </span>

            </p>
            <p>5-比特币实现
                <span>比特币的全节点在内存中维护一个数据结构叫做UTXO，记录那些未被花掉的BTC。比特币矿工除了去争夺记账权获得coinbase的奖励之外，
                    打包交易还有一个打包费用，但是在例子中一个区块的出块奖励是12.5btc 远远大于fee 0.12 100倍。一个区块在比特币中的规定是只有1M大小，
                    比特币有使用TX base 基于交易的记账系统，他的特点就是无账户，所以需要去计算币来源防止双花，另一种以太坊，则类似银行，
                    是一种基于账户的记账系统，大概记录了那些账号存在有多少代币。那么挖矿的nonce 也只有2^32的可能性，小于整个2^256的解空间，也就是对于
                    全遍历而言依然还有可能是挖不到矿的，在数据字段中，MT hash是可以修改的，这很神奇，因为第一个TX交易为自己的coinbase，在coinbase
                    中写任何东西都没人管，所以会产生一个8字节的额外随机数，总共就是2^96,这样挖到矿的概率就高了，毕竟前导0得256-96=160个才在一个比较
                    均匀区间去限制我们挖矿 puzzle。交易执行脚本，为前节点的输出币来源与后节点输入币去处加在一块执行，这是比特币脚本，以太坊智能合约应该也差不多。
                    比特币挖矿寻找nonce，对于单次而言是独立的的伯努利，无记忆性的，对于一系列的nonce而言是泊松分布，学过概率论知道，指的就是单词概率
                    低而重复多次的，同样也是无记忆性，以概率密度保障出块时间为10分钟左右。那么所有的比特币是2100w个这个我以前就会算，在这里也就不表了。
                    对于某次挖矿，10分钟都未曾产生区块，那么产生区块的可能时间依旧为10分钟，从任何一点去切概率时间密度函数都是无记忆延续的结果。
                    挖矿耗费大量的电力，那么它到底有什么意义呢，当然有为了比特币整体的安全性，矿工目前是在为了初块奖励，但在将来为了
                    矿工费fee，保证系统的诚实节点足够才是比特币网络的安全。前面说的nonce+MT hash的 96位 其实是两层for循环，
                    外循环是2^64的mt hash 外循环是2^32的hash。那么假如有个不诚实的恶意节点M获得记账权，乱记账怎么办。
                    1.A->M 记录A给自己转账 不行因为没有A的私钥来签名
                    2.M->A 后M-M' 双花，也不行，无法通过诚实节点的验证，诚实节点不会在这个区块之后挖，而是分叉出来挖，导致这个区块的初块奖励作废。
                    保证共识POW不仅仅是选出诚实节点作为记账矿工，而且在最长链方面也保障了整个比特币系统的安全。也有可能恶意节点会拒绝记录那些
                    合法的交易内容，这些交易内容可以留在下一个节点去记录。还有一种攻击叫做self mining 也不行 在算力不足的情况下竞争过
                    最长链的可能性很小，基本是薄一博单变摩托。而且偷偷藏着可能会导致前面的初块奖励作废。一般都是6个区块的 confirment，
                    但是目前比较多用的还是最先接听原则，即M给A了 就不再接听M给m'。好了 结束 我喜欢zhenxiao老师 听课是真爽。
                    更mit的吉尔伯特的线性代数一样。北大的老师比较放飞 郭炜也是

                </span>
                <span>

                </span>
            </p>
        </div>
    </body>

</html>